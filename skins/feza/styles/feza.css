/**
 * FEZA Enterprise Mail - Custom skin styles
 * Based on Roundcube Elastic skin with FEZA Logistics branding
 */

/* =============================================
   CSS CUSTOM PROPERTIES (FEZA BRAND VARIABLES)
   ============================================= */
:root {
  --feza-primary:        #071a2f;
  --feza-accent:         #0a4da3;
  --feza-success:        #2ec27e;
  --feza-warning:        #f5a623;
  --feza-danger:         #e74c3c;
  --feza-bg:             #eaf2fb;
  --feza-white:          #ffffff;
  --feza-text:           #1a1a2e;
  --feza-text-muted:     #6c757d;
  --feza-border:         #dee2e6;
  --feza-shadow:         0 2px 8px rgba(0, 0, 0, 0.08);
  --feza-shadow-lg:      0 8px 32px rgba(0, 0, 0, 0.16);
  --feza-radius:         8px;
  --feza-sidebar-width:  240px;
  --feza-header-height:  56px;
  --feza-menu-width:     56px;
  --feza-transition:     0.2s ease;
}

/* =============================================
   GLOBAL TYPOGRAPHY & BASE
   ============================================= */
body,
button,
input,
optgroup,
select,
textarea,
.popover {
  font-family: 'Segoe UI', Inter, -apple-system, BlinkMacSystemFont,
               'Helvetica Neue', Arial, sans-serif !important;
  color: var(--feza-text);
}

html, body {
  background-color: var(--feza-bg);
}

a {
  color: var(--feza-accent);
}

a:hover {
  color: #083d82;
}

/* =============================================
   LAYOUT STRUCTURE — OVERFLOW FIX
   ============================================= */

/* Prevent horizontal scrolling at root level */
html, body {
  max-width: 100%;
  overflow-x: hidden;
}

#layout {
  background-color: var(--feza-bg);
  display: flex;
  flex-direction: row;
  max-width: 100%;
  overflow-x: hidden;
  width: 100%;
}

/* Task menu (left-most icon bar) */
#layout-menu {
  background-color: var(--feza-primary) !important;
  border-right: none !important;
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
  width: var(--feza-menu-width);
  min-width: var(--feza-menu-width);
  flex-shrink: 0;
}

/* Sidebar (folder list) */
#layout-sidebar {
  background-color: var(--feza-primary) !important;
  border-right: 1px solid rgba(255, 255, 255, 0.08) !important;
  color: #e0eaf5;
  width: var(--feza-sidebar-width);
  min-width: var(--feza-sidebar-width);
  flex-shrink: 0;
  overflow-x: hidden;
}

#layout-sidebar .header {
  background-color: var(--feza-primary) !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
  color: var(--feza-white);
  height: var(--feza-header-height);
  line-height: var(--feza-header-height);
}

#layout-sidebar .header .header-title {
  color: rgba(255, 255, 255, 0.75);
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Message list — flex child, constrained */
#layout-list {
  background-color: var(--feza-white);
  border-right: 1px solid var(--feza-border);
  flex: 0 0 320px;
  min-width: 0;
  overflow-x: hidden;
}

#layout-list .header,
#messagelist-header {
  background-color: var(--feza-white) !important;
  border-bottom: 1px solid var(--feza-border) !important;
  height: var(--feza-header-height);
  line-height: var(--feza-header-height);
}

/* Content pane — grows to fill remaining space */
#layout-content {
  background-color: var(--feza-bg);
  display: flex;
  flex: 1 1 0;
  flex-direction: column;
  min-height: 0;
  min-width: 0;
  overflow-x: hidden;
}

/* Preview pane iframe wrapper — fills all available vertical space */
#layout-content .iframe-wrapper {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  position: relative;
  width: 100%;
}

#messagecontframe {
  border: 0;
  display: block;
  height: 100%;
  width: 100%;
}

/* Text truncation helpers applied to list cells */
#messagelist td.subject,
#messagelist td.from,
#messagelist td.to {
  max-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Subject column should take most available space */
#messagelist col.subject { width: 40%; }
#messagelist col.from    { width: 20%; }
#messagelist col.date    { width: 12%; }
#messagelist col.flags   { width: 8%;  }

/* =============================================
   TASK MENU (LEFT ICON BAR)
   ============================================= */
#taskmenu {
  background-color: var(--feza-primary);
  padding-top: 8px;
}

#taskmenu a,
#taskmenu .button {
  color: rgba(255, 255, 255, 0.6) !important;
  border-radius: var(--feza-radius);
  margin: 2px 6px;
  transition: background-color 0.2s ease, color 0.2s ease;
}

#taskmenu a:hover,
#taskmenu .button:hover {
  color: var(--feza-white) !important;
  background-color: rgba(255, 255, 255, 0.1) !important;
}

#taskmenu a.selected,
#taskmenu .button.selected {
  color: var(--feza-white) !important;
  background-color: var(--feza-accent) !important;
}

/* Compose button in taskmenu */
#taskmenu .compose {
  background-color: var(--feza-accent) !important;
  color: var(--feza-white) !important;
  border-radius: var(--feza-radius) !important;
  margin: 8px 6px !important;
}

#taskmenu .compose:hover {
  background-color: #083d82 !important;
}

/* Logo area in popover header */
.popover-header {
  background-color: var(--feza-primary) !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
  padding: 12px 16px;
}

.popover-header #logo {
  max-height: 40px;
  max-width: 180px;
}

/* =============================================
   SIDEBAR FOLDER LIST
   ============================================= */
#folderlist-content {
  background-color: var(--feza-primary);
  padding: 8px 0;
}

#mailboxlist {
  background-color: transparent;
}

#mailboxlist li a,
#mailboxlist .mailbox {
  color: rgba(255, 255, 255, 0.75) !important;
  border-radius: 6px !important;
  margin: 1px 8px !important;
  padding: 8px 10px !important;
  transition: all 0.15s ease;
}

#mailboxlist li a:hover {
  background-color: rgba(255, 255, 255, 0.1) !important;
  color: var(--feza-white) !important;
}

#mailboxlist li.selected > a,
#mailboxlist li.selected > .mailbox {
  background-color: var(--feza-accent) !important;
  color: var(--feza-white) !important;
}

/* Unread count badge */
#mailboxlist .unread {
  background-color: var(--feza-success) !important;
  color: var(--feza-white) !important;
  border-radius: 10px !important;
  font-size: 0.7rem;
  padding: 1px 6px;
  min-width: 18px;
  text-align: center;
}

/* =============================================
   HEADER / TOOLBAR
   ============================================= */
.header .toolbar,
#messagelist-header .toolbar {
  background-color: transparent;
}

.toolbar .button,
.toolbar a.button,
.toolbar .btn {
  border-radius: 6px;
  transition: background-color 0.15s ease;
}

/* =============================================
   MESSAGE LIST (CARD-STYLE ROWS)
   ============================================= */

/* ===========================
   ROUNDCUBE MESSAGE VISIBILITY
=========================== */

#messagelistcontainer,
#messagelist {
  height: 100% !important;
  min-height: 400px;
}

#messagelist,
#messagelist table,
#messagelist tbody,
#messagelist tr,
#messagelist td {
  visibility: visible !important;
  opacity: 1 !important;
}

#messagelist tr {
  display: table-row !important;
  height: auto !important;
}

#messagelist td {
  display: table-cell !important;
  color: var(--feza-text) !important;
  background: var(--feza-white) !important;
}

#messagelist {
  background-color: var(--feza-white);
  width: 100%;
  overflow: auto;
  z-index: 10;
  position: relative;
}

#messagelist thead {
  background-color: #f8fafc;
  border-bottom: 1px solid var(--feza-border);
}

#messagelist thead th {
  color: var(--feza-text-muted);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

#messagelist tbody tr {
  border-bottom: 1px solid #f0f4f8;
  transition: background-color 0.1s ease;
}

#messagelist tbody tr:hover {
  background-color: #f0f7ff !important;
}

#messagelist tbody tr.selected {
  background-color: #e8f0fe !important;
}

/* Unread message row */
#messagelist tbody tr.unread td.subject {
  font-weight: 700;
  color: var(--feza-text);
}

#messagelist tbody tr.unread {
  background-color: #fafcff;
}

/* Message row - star / flag */
#messagelist .flagged td.flags .flag,
#messagelist .icon-flagged:before {
  color: #f5a623 !important;
}

/* =============================================
   SEARCH BAR
   ============================================= */
#mailsearchform,
.searchbar {
  background-color: var(--feza-white);
  border-bottom: 1px solid var(--feza-border);
}

#mailsearchform input[type="text"],
#mailsearchform input[type="search"],
.searchbar input {
  background-color: #f4f7fb !important;
  border: 1px solid var(--feza-border) !important;
  border-radius: 20px !important;
  padding: 6px 16px !important;
  font-size: 0.875rem;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

#mailsearchform input[type="text"]:focus,
#mailsearchform input[type="search"]:focus,
.searchbar input:focus {
  border-color: var(--feza-accent) !important;
  box-shadow: 0 0 0 3px rgba(10, 77, 163, 0.12) !important;
  background-color: var(--feza-white) !important;
  outline: none;
}

/* =============================================
   MESSAGE VIEW (READING PANE)
   ============================================= */
#messageview {
  background-color: var(--feza-white);
  border-radius: var(--feza-radius);
  box-shadow: var(--feza-shadow);
  margin: 12px;
}

#message-header,
.message-header {
  background-color: var(--feza-white);
  border-bottom: 1px solid var(--feza-border);
  padding: 16px 20px;
}

/* Sender avatar (initials circle) */
.message-header .sender-avatar,
#message-header .contact-photo {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background-color: var(--feza-accent);
  color: var(--feza-white);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1rem;
  flex-shrink: 0;
}

#message-subject,
.message-subject {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--feza-text);
}

/* Message action toolbar */
#messageview .header .toolbar,
#message-header .toolbar {
  background-color: var(--feza-white);
  border-bottom: 1px solid var(--feza-border);
  position: sticky;
  top: 0;
  z-index: 10;
}

/* =============================================
   COMPOSE WINDOW
   ============================================= */
.task-mail.action-compose #layout-content,
#compose-content {
  background-color: var(--feza-white);
  border-radius: var(--feza-radius);
  box-shadow: var(--feza-shadow);
  margin: 12px;
}

.compose-header,
#compose-content .header {
  background-color: var(--feza-primary) !important;
  color: var(--feza-white) !important;
  border-radius: var(--feza-radius) var(--feza-radius) 0 0;
}

/* Compose form fields */
#compose-to,
#compose-cc,
#compose-bcc,
#compose-subject {
  border-bottom: 1px solid var(--feza-border) !important;
  border-radius: 0 !important;
  padding: 10px 16px !important;
}

#compose-subject input,
.compose-subject input {
  font-size: 1rem;
  font-weight: 500;
}

/* Send button */
#compose-toolbar .send,
a.button.send,
button.send {
  background-color: var(--feza-accent) !important;
  color: var(--feza-white) !important;
  border-radius: 6px !important;
  border: none !important;
  padding: 8px 20px !important;
  font-weight: 600;
}

#compose-toolbar .send:hover,
a.button.send:hover,
button.send:hover {
  background-color: #083d82 !important;
}

/* =============================================
   BUTTONS (GLOBAL)
   ============================================= */
.btn-primary,
button.btn-primary {
  background-color: var(--feza-accent) !important;
  border-color: var(--feza-accent) !important;
  border-radius: 6px !important;
  font-weight: 500;
}

.btn-primary:hover,
button.btn-primary:hover {
  background-color: #083d82 !important;
  border-color: #083d82 !important;
}

.btn-secondary,
button.btn-secondary {
  border-radius: 6px !important;
}

.btn-success,
button.btn-success {
  background-color: var(--feza-success) !important;
  border-color: var(--feza-success) !important;
  border-radius: 6px !important;
}

/* =============================================
   FORMS & INPUTS
   ============================================= */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="search"],
textarea,
select {
  border-radius: 6px !important;
  border-color: var(--feza-border) !important;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

input[type="text"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
input[type="search"]:focus,
textarea:focus,
select:focus {
  border-color: var(--feza-accent) !important;
  box-shadow: 0 0 0 3px rgba(10, 77, 163, 0.12) !important;
  outline: none;
}

/* =============================================
   LOGIN PAGE
   ============================================= */
.task-login {
  background: linear-gradient(135deg, var(--feza-primary) 0%, #0a2550 100%);
  min-height: 100vh;
}

.task-login #layout-content {
  background: transparent;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 40px 20px;
}

.task-login #login-form {
  background-color: var(--feza-white);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.24);
  padding: 40px 48px;
  width: 100%;
  max-width: 420px;
}

.task-login #logo {
  max-width: 200px;
  margin-bottom: 32px;
}

.task-login #login-form .formbuttons .btn-primary {
  width: 100%;
  padding: 12px;
  font-size: 1rem;
  font-weight: 600;
  background-color: var(--feza-accent) !important;
  border-color: var(--feza-accent) !important;
}

.task-login #login-footer {
  color: rgba(255, 255, 255, 0.5);
  font-size: 0.8rem;
  margin-top: 24px;
  text-align: center;
}

.task-login #login-footer a {
  color: rgba(255, 255, 255, 0.7);
}

/* =============================================
   CARDS / PANELS
   ============================================= */
.propform,
.formcontainer,
.rcube-frame {
  border-radius: var(--feza-radius);
}

/* =============================================
   ATTACHMENTS
   ============================================= */
.attachments-list li,
.attachment-preview {
  background-color: #f8fafc;
  border: 1px solid var(--feza-border);
  border-radius: 6px;
  padding: 8px 12px;
  transition: background-color 0.15s ease;
}

.attachments-list li:hover,
.attachment-preview:hover {
  background-color: #eef3fb;
}

/* =============================================
   QUOTA DISPLAY
   ============================================= */
#quotadisplay {
  background-color: rgba(255, 255, 255, 0.08);
  border-radius: 6px;
  padding: 6px 10px;
  margin: 8px;
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.75rem;
}

/* =============================================
   DIALOGS / MODALS
   ============================================= */
.ui-dialog,
.modal-content {
  border-radius: var(--feza-radius) !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18) !important;
  border: none !important;
}

.ui-dialog .ui-dialog-titlebar,
.modal-header {
  background-color: var(--feza-primary) !important;
  color: var(--feza-white) !important;
  border-radius: var(--feza-radius) var(--feza-radius) 0 0 !important;
  border-bottom: none !important;
}

.ui-dialog .ui-dialog-titlebar .ui-dialog-title {
  color: var(--feza-white);
}

/* =============================================
   RESPONSIVE ENTERPRISE GRID SYSTEM
   ============================================= */

/* --- 1200px: wide desktop, list narrows --- */
@media (max-width: 1200px) {
  #layout-list {
    flex: 0 0 280px;
  }
}

/* --- 992px: tablet landscape — sidebar collapsible --- */
@media (max-width: 992px) {
  #layout-list {
    flex: 0 0 240px;
  }
}

/* --- 768px: tablet portrait — single-panel focus --- */
@media (max-width: 768px) {
  :root {
    --feza-sidebar-width: 260px;
    --feza-menu-width: 48px;
  }

  #layout-menu {
    width: var(--feza-menu-width);
    min-width: var(--feza-menu-width);
  }

  #layout-list {
    flex: 1 1 auto;
    width: 100%;
  }

  .task-login #login-form {
    padding: 28px 24px;
  }
}

/* --- 480px: mobile portrait — stack panels --- */
@media (max-width: 480px) {
  :root {
    --feza-header-height: 48px;
  }

  #layout {
    flex-direction: column;
  }

  #layout-menu {
    width: 100%;
    min-width: 0;
    height: var(--feza-header-height);
    flex-direction: row;
  }

  #layout-sidebar {
    width: 100%;
    min-width: 0;
  }

  #layout-list,
  #layout-content {
    width: 100%;
    min-width: 0;
  }

  #messagelist td.subject {
    max-width: 180px;
  }

  .task-login #login-form {
    padding: 24px 20px;
    border-radius: 8px;
  }

  /* Bottom action bar for mobile */
  #feza-mobile-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 200;
    background: var(--feza-white);
    border-top: 1px solid var(--feza-border);
    display: flex;
    justify-content: space-around;
    align-items: center;
    height: 56px;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
  }

  #feza-mobile-bar a,
  #feza-mobile-bar button {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.65rem;
    color: var(--feza-text-muted);
    background: none;
    border: none;
    padding: 4px 12px;
    cursor: pointer;
    min-width: 48px;
    min-height: 44px;
    justify-content: center;
  }

  #feza-mobile-bar a.active,
  #feza-mobile-bar button.active {
    color: var(--feza-accent);
  }

  /* Add padding so content isn't hidden behind bottom bar */
  #layout-content {
    padding-bottom: 56px;
  }
}

/* =============================================
   MOBILE TOUCH ENHANCEMENTS
   ============================================= */

/* Touch-friendly minimum tap target */
@media (hover: none) and (pointer: coarse) {
  .toolbar .button,
  .toolbar a.button,
  .toolbar .btn,
  #mailboxlist li a,
  #messagelist tbody tr {
    min-height: 44px;
    min-width: 44px;
  }
}

/* Floating compose button (mobile) */
#feza-fab {
  display: none;
  position: fixed;
  bottom: 72px;
  right: 20px;
  z-index: 199;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background-color: var(--feza-accent);
  color: var(--feza-white);
  box-shadow: 0 4px 16px rgba(10,77,163,0.4);
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  transition: background-color var(--feza-transition), transform var(--feza-transition);
}

#feza-fab:hover,
#feza-fab:focus {
  background-color: #083d82;
  transform: scale(1.08);
}

@media (max-width: 768px) {
  #feza-fab {
    display: flex;
  }
}

/* =============================================
   DARK MODE SUPPORT
   ============================================= */
html.dark-mode {
  --feza-bg:            #0f1923;
  --feza-white:         #1a2535;
  --feza-text:          #e0eaf5;
  --feza-text-muted:    #8899aa;
  --feza-border:        #2a3a4a;
  --feza-shadow:        0 2px 8px rgba(0, 0, 0, 0.3);
}

html.dark-mode body,
html.dark-mode #layout {
  background-color: var(--feza-bg);
}

html.dark-mode #layout-list,
html.dark-mode #layout-content {
  background-color: var(--feza-white);
}

html.dark-mode #layout-list .header,
html.dark-mode #messagelist-header {
  background-color: var(--feza-white) !important;
  border-bottom-color: var(--feza-border) !important;
}

html.dark-mode #messagelist tbody tr:hover {
  background-color: #1e3048 !important;
}

html.dark-mode #messagelist tbody tr.selected {
  background-color: #1a2e45 !important;
}

html.dark-mode #messageview,
html.dark-mode .task-mail.action-compose #layout-content,
html.dark-mode #compose-content {
  background-color: var(--feza-white);
}

/* =============================================
   LOGIN BRAND SECTION
   ============================================= */
.feza-login-brand {
  text-align: center;
  margin-bottom: 32px;
}

.feza-login-brand #logo {
  max-width: 220px;
  margin: 0 auto 12px;
  display: block;
}

.feza-login-tagline {
  color: rgba(255, 255, 255, 0.65);
  font-size: 0.9rem;
  margin: 0;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

/* =============================================
   NOTIFICATION TOASTS
   ============================================= */
#messagestack .ui-notification,
.ui-notification {
  border-radius: var(--feza-radius) !important;
  box-shadow: var(--feza-shadow) !important;
  border-left: 4px solid var(--feza-accent) !important;
}

.ui-notification.success {
  border-left-color: var(--feza-success) !important;
}

/* =============================================
   EMPTY STATE (no messages in folder)
   ============================================= */
.feza-empty-state {
  align-items: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 60px 24px;
  text-align: center;
  width: 100%;
}

.feza-empty-icon {
  font-size: 3.5rem;
  margin-bottom: 16px;
  opacity: 0.45;
}

.feza-empty-title {
  color: var(--feza-text);
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 8px;
}

.feza-empty-subtitle {
  color: var(--feza-text-muted);
  font-size: 0.875rem;
  margin-bottom: 24px;
  max-width: 280px;
}

.feza-empty-compose-btn {
  background-color: var(--feza-accent);
  border: none;
  border-radius: 6px;
  color: var(--feza-white);
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  padding: 10px 24px;
  transition: background-color var(--feza-transition);
}

.feza-empty-compose-btn:hover,
.feza-empty-compose-btn:focus {
  background-color: #083d82;
}

html.dark-mode .feza-empty-title {
  color: var(--feza-text);
}

/* =============================================
   SKELETON LOADING STATES
   ============================================= */
.feza-skeleton {
  background: linear-gradient(90deg, #f0f4f8 25%, #e4eaf2 50%, #f0f4f8 75%);
  background-size: 200% 100%;
  animation: feza-shimmer 1.5s infinite;
  border-radius: 4px;
}

@keyframes feza-shimmer {
  0%   { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* =============================================
   SMOOTH TRANSITIONS
   ============================================= */
#layout-sidebar,
#layout-menu,
#layout-list,
#layout-content {
  transition: width 0.25s ease, min-width 0.25s ease;
}

.listing li a,
.listing li .mailbox {
  transition: background-color 0.15s ease, color 0.15s ease;
}

/* =============================================
   SMART EMAIL SUGGESTIONS PANEL
   ============================================= */
#feza-suggestions {
  background: linear-gradient(135deg, #eef5ff 0%, #f0fdf4 100%);
  border: 1px solid #c7deff;
  border-radius: var(--feza-radius);
  padding: 10px 14px;
  margin: 0 0 8px;
  font-size: 0.85rem;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  animation: feza-slide-in 0.25s ease;
}

@keyframes feza-slide-in {
  from { opacity: 0; transform: translateY(-6px); }
  to   { opacity: 1; transform: translateY(0); }
}

#feza-suggestions .feza-suggestion-icon {
  font-size: 1.1rem;
  flex-shrink: 0;
  margin-top: 1px;
}

#feza-suggestions .feza-suggestion-body {
  flex: 1;
  min-width: 0;
}

#feza-suggestions .feza-suggestion-title {
  font-weight: 600;
  color: var(--feza-text);
  margin-bottom: 4px;
}

#feza-suggestions .feza-suggestion-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 6px;
}

.feza-quick-reply {
  background: var(--feza-white);
  border: 1px solid var(--feza-accent);
  border-radius: 20px;
  color: var(--feza-accent);
  font-size: 0.78rem;
  font-weight: 500;
  padding: 4px 12px;
  cursor: pointer;
  transition: background var(--feza-transition), color var(--feza-transition);
  white-space: nowrap;
}

.feza-quick-reply:hover,
.feza-quick-reply:focus {
  background: var(--feza-accent);
  color: var(--feza-white);
}

/* Attachment warning banner */
#feza-attachment-warning {
  background: #fff8e6;
  border: 1px solid #f5a623;
  border-left: 4px solid #f5a623;
  border-radius: var(--feza-radius);
  padding: 10px 14px;
  margin: 0 0 8px;
  font-size: 0.85rem;
  color: #7a4a00;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: feza-slide-in 0.25s ease;
}

/* =============================================
   UNDO SEND TOAST
   ============================================= */
#feza-undo-toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9998;
  background: var(--feza-primary);
  color: var(--feza-white);
  border-radius: var(--feza-radius);
  padding: 12px 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  box-shadow: var(--feza-shadow-lg);
  font-size: 0.9rem;
  animation: feza-slide-in 0.25s ease;
}

#feza-undo-toast .feza-undo-btn {
  background: var(--feza-accent);
  color: var(--feza-white);
  border: none;
  border-radius: 6px;
  padding: 6px 14px;
  font-weight: 600;
  cursor: pointer;
  font-size: 0.85rem;
  transition: background var(--feza-transition);
}

#feza-undo-toast .feza-undo-btn:hover {
  background: #083d82;
}

#feza-undo-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: var(--feza-accent);
  border-radius: 0 0 var(--feza-radius) var(--feza-radius);
  animation: feza-undo-countdown 8s linear forwards;
}

@keyframes feza-undo-countdown {
  from { width: 100%; }
  to   { width: 0%; }
}

/* =============================================
   MESSAGE VIEW — PROFESSIONAL ENHANCEMENTS
   ============================================= */

/* Sticky action toolbar */
#messageview .header .toolbar,
#message-header .toolbar {
  position: sticky;
  top: 0;
  z-index: 20;
  background-color: var(--feza-white);
  border-bottom: 1px solid var(--feza-border);
}

/* Hover quick-actions on message list rows */
#messagelist tbody tr .feza-row-actions {
  display: none;
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  gap: 4px;
  align-items: center;
  background: var(--feza-white);
  border: 1px solid var(--feza-border);
  border-radius: 20px;
  padding: 2px 8px;
  box-shadow: var(--feza-shadow);
}

#messagelist tbody tr:hover .feza-row-actions {
  display: flex;
}

#messagelist tbody tr {
  position: relative;
}

.feza-row-action-btn {
  background: none;
  border: none;
  padding: 4px 6px;
  cursor: pointer;
  font-size: 0.8rem;
  color: var(--feza-text-muted);
  border-radius: 4px;
  transition: color var(--feza-transition), background var(--feza-transition);
}

.feza-row-action-btn:hover {
  color: var(--feza-accent);
  background: #eef3fb;
}

/* Expand/collapse long messages */
.feza-message-collapsed {
  max-height: 320px;
  overflow: hidden;
  position: relative;
}

.feza-message-collapsed::after {
  content: '';
  display: block;
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: linear-gradient(transparent, var(--feza-white));
  pointer-events: none;
}

.feza-expand-btn {
  display: block;
  width: 100%;
  text-align: center;
  background: none;
  border: 1px solid var(--feza-border);
  border-radius: 20px;
  padding: 6px;
  color: var(--feza-accent);
  font-size: 0.82rem;
  cursor: pointer;
  margin: 8px 0;
  transition: background var(--feza-transition);
}

.feza-expand-btn:hover {
  background: #eef3fb;
}

/* =============================================
   SEARCH FILTER CHIPS
   ============================================= */
#feza-search-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  padding: 6px 12px;
  border-bottom: 1px solid var(--feza-border);
  background: var(--feza-white);
}

.feza-chip {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #eef3fb;
  border: 1px solid #c7deff;
  border-radius: 16px;
  padding: 4px 12px;
  font-size: 0.78rem;
  font-weight: 500;
  color: var(--feza-accent);
  cursor: pointer;
  transition: background var(--feza-transition), color var(--feza-transition);
  white-space: nowrap;
}

.feza-chip:hover,
.feza-chip.active {
  background: var(--feza-accent);
  color: var(--feza-white);
  border-color: var(--feza-accent);
}

/* Highlighted search matches */
.feza-highlight {
  background: #fff3cd;
  border-radius: 2px;
  padding: 0 2px;
  font-weight: 600;
}

/* =============================================
   PRIORITY INDICATOR
   ============================================= */
.feza-priority {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  margin-right: 4px;
  vertical-align: middle;
  flex-shrink: 0;
}

.feza-priority-high   { background: var(--feza-danger); }
.feza-priority-medium { background: var(--feza-warning); }
.feza-priority-low    { background: var(--feza-success); }

/* =============================================
   EMAIL SNOOZE PICKER
   ============================================= */
#feza-snooze-popup {
  position: absolute;
  z-index: 500;
  background: var(--feza-white);
  border: 1px solid var(--feza-border);
  border-radius: var(--feza-radius);
  box-shadow: var(--feza-shadow-lg);
  padding: 8px 0;
  min-width: 200px;
  animation: feza-slide-in 0.15s ease;
}

#feza-snooze-popup button {
  display: block;
  width: 100%;
  text-align: left;
  background: none;
  border: none;
  padding: 10px 16px;
  font-size: 0.875rem;
  color: var(--feza-text);
  cursor: pointer;
  transition: background var(--feza-transition);
}

#feza-snooze-popup button:hover {
  background: #f0f7ff;
}

/* =============================================
   INLINE QUICK REPLY BOX
   ============================================= */
#feza-quick-reply {
  background: var(--feza-white);
  border: 1px solid var(--feza-border);
  border-radius: var(--feza-radius);
  padding: 12px 16px;
  margin: 12px;
  box-shadow: var(--feza-shadow);
}

#feza-quick-reply textarea {
  width: 100%;
  border: none;
  resize: none;
  font-family: inherit;
  font-size: 0.9rem;
  color: var(--feza-text);
  outline: none;
  min-height: 60px;
}

#feza-quick-reply .feza-qr-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid var(--feza-border);
}

/* =============================================
   DARK MODE — EXTENDED
   ============================================= */
html.dark-mode #feza-suggestions {
  background: linear-gradient(135deg, #1a2e45 0%, #1a2e36 100%);
  border-color: #2a3a5a;
}

html.dark-mode .feza-quick-reply {
  background: #1a2535;
  border-color: #2a4a8a;
  color: #7ab3ff;
}

html.dark-mode .feza-quick-reply:hover,
html.dark-mode .feza-quick-reply:focus {
  background: var(--feza-accent);
  color: var(--feza-white);
}

html.dark-mode #feza-search-chips {
  background: #1a2535;
  border-bottom-color: var(--feza-border);
}

html.dark-mode .feza-chip {
  background: #1a2e45;
  border-color: #2a3a5a;
  color: #7ab3ff;
}

html.dark-mode #feza-snooze-popup,
html.dark-mode #feza-quick-reply {
  background: #1a2535;
  border-color: var(--feza-border);
  color: var(--feza-text);
}

/* =============================================
   SUBJECT-FIRST PROFESSIONAL LAYOUT
   ============================================= */

/* Subject: primary weight, clearly dominant */
#messagelist td.subject {
  font-weight: 600;
  font-size: 14px;
  color: var(--feza-text);
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Sender & date: secondary, muted */
#messagelist td.from,
#messagelist td.date {
  font-size: 12px;
  color: var(--feza-text-muted);
  font-weight: 400;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Hide size and extra flag columns visually (Prompt 7) */
#messagelist td.size,
#messagelist th.size,
#messagelist col.size {
  visibility: hidden;
  width: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  overflow: hidden;
  max-width: 0;
}

/* =============================================
   RESPONSIVE MESSAGE LIST — FIXED TABLE LAYOUT
   ============================================= */

#messagelist {
  table-layout: fixed;
  width: 100%;
  background-color: var(--feza-white);
  overflow-x: hidden;
  z-index: 10;
  position: relative;
}

/* Column widths: subject gets the lion's share */
#messagelist col.subject { width: 55%; }
#messagelist col.from    { width: 22%; }
#messagelist col.date    { width: 15%; }
#messagelist col.flags   { width: 8%;  }

/* Tablet: compress columns */
@media (max-width: 992px) {
  #messagelist col.subject { width: 60%; }
  #messagelist col.from    { width: 25%; }
  #messagelist col.date    { width: 15%; }
}

/* Mobile: subject takes full row, metadata below */
@media (max-width: 600px) {
  #messagelist col.subject { width: 75%; }
  #messagelist col.from    { width: 0; }
  #messagelist col.date    { width: 25%; }

  #messagelist td.from {
    display: none;
  }

  #messagelist td.subject {
    max-width: 100%;
  }
}

/* =============================================
   SETTINGS NAVIGATION — ALWAYS VISIBLE
   ============================================= */

/* Ensure no custom CSS accidentally hides settings task link */
#taskmenu a.settings,
#taskmenu .button.settings,
#taskmenu a[href*="_task=settings"],
.feza-settings-link {
  display: flex !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Settings panels must not be hidden */
.task-settings #layout-content,
.task-settings #mainscreencontent,
.task-settings .formcontainer,
.task-settings iframe,
.task-settings .rcube-frame,
.task-settings #preferences-details,
.task-settings #identities-table,
.task-settings #responses-table,
.task-settings #folders-table {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  overflow: visible !important;
}

/* =============================================
   SETTINGS PANELS — RESTORE VISIBILITY
   ============================================= */

/* Settings task: main workspace must be visible */
.task-settings #layout-content {
  display: flex !important;
  flex-direction: row !important;
  flex: 1 1 0 !important;
  overflow: visible !important;
  min-height: 0 !important;
}

/* Settings list sidebar (left) */
.task-settings #layout-sidebar,
.task-settings #settings-sections {
  display: block !important;
  visibility: visible !important;
  overflow: auto !important;
}

/* Settings frame (right content area) */
.task-settings #preferences-details,
.task-settings #settings-right,
.task-settings .propform,
.task-settings .settingslist,
.task-settings table.records-table {
  display: block !important;
  visibility: visible !important;
  overflow: auto !important;
  height: auto !important;
  max-height: none !important;
}

/* iFrames used by settings pages */
.task-settings iframe {
  display: block !important;
  width: 100% !important;
  min-height: 400px;
  border: 0;
}

/* =============================================
   FEZA ENTERPRISE HOME DASHBOARD
   ============================================= */
#feza-dashboard {
  display: flex;
  flex-direction: column;
  gap: 24px;
  padding: 32px 36px;
  background: var(--feza-bg);
  min-height: 100%;
  box-sizing: border-box;
  overflow-y: auto;
}

.feza-dash-header {
  border-bottom: 1px solid var(--feza-border);
  padding-bottom: 16px;
}

.feza-dash-greeting {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--feza-text);
}

.feza-dash-email {
  font-size: 0.875rem;
  color: var(--feza-text-muted);
  margin-top: 4px;
}

/* Dashboard cards row */
.feza-dash-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}

.feza-dash-card {
  background: var(--feza-white);
  border: 1px solid var(--feza-border);
  border-radius: var(--feza-radius);
  box-shadow: var(--feza-shadow);
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px 20px;
  flex: 1 1 180px;
  min-width: 160px;
  transition: box-shadow var(--feza-transition), transform var(--feza-transition);
}

.feza-dash-card:hover {
  box-shadow: var(--feza-shadow-lg);
  transform: translateY(-2px);
}

.feza-dash-card-icon {
  font-size: 1.8rem;
  flex-shrink: 0;
}

.feza-dash-card-title {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--feza-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.feza-dash-card-value {
  font-size: 1rem;
  font-weight: 700;
  color: var(--feza-text);
  margin-top: 2px;
}

/* Recent messages section */
.feza-dash-recent {
  background: var(--feza-white);
  border: 1px solid var(--feza-border);
  border-radius: var(--feza-radius);
  box-shadow: var(--feza-shadow);
  padding: 16px 20px;
}

.feza-dash-section-title {
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--feza-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 12px;
}

.feza-dash-recent-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.feza-dash-recent-item {
  display: flex;
  flex-direction: column;
  padding: 10px 0;
  border-bottom: 1px solid var(--feza-border);
  transition: background var(--feza-transition);
  border-radius: 4px;
}

.feza-dash-recent-item:last-child {
  border-bottom: 0;
}

.feza-dash-recent-item:hover {
  background: #f0f7ff;
  padding-left: 6px;
}

.feza-dash-recent-subject {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--feza-text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.feza-dash-recent-unread .feza-dash-recent-subject {
  font-weight: 700;
}

.feza-dash-recent-meta {
  font-size: 0.75rem;
  color: var(--feza-text-muted);
  margin-top: 2px;
}

.feza-dash-recent-empty {
  color: var(--feza-text-muted);
  font-size: 0.875rem;
  padding: 12px 0;
}

/* Responsive dashboard */
@media (max-width: 600px) {
  #feza-dashboard {
    padding: 16px;
    gap: 16px;
  }

  .feza-dash-cards {
    flex-direction: column;
  }

  .feza-dash-card {
    flex: 1 1 auto;
    width: 100%;
  }
}

/* Dark mode */
html.dark-mode #feza-dashboard {
  background: var(--feza-bg);
}

html.dark-mode .feza-dash-card,
html.dark-mode .feza-dash-recent {
  background: var(--feza-white);
  border-color: var(--feza-border);
}

html.dark-mode .feza-dash-recent-item:hover {
  background: #1e3048;
}

/* =============================================
   EMAIL READING HIERARCHY — TITLE CLARITY
   ============================================= */

/* 1. Subject — highest prominence */
#messagelist td.subject span.subject,
#messagelist td.subject {
  font-size: 14px !important;
  font-weight: 600 !important;
  color: var(--feza-text) !important;
  line-height: 1.4;
}

/* 2. Unread subject gets stronger weight */
#messagelist tr.unread td.subject span.subject,
#messagelist tr.unread td.subject {
  font-weight: 700 !important;
}

/* 3. Sender — secondary, explicitly smaller */
#messagelist td.from,
#messagelist td.from span {
  font-size: 11px !important;
  color: var(--feza-text-muted) !important;
  font-weight: 400 !important;
}

/* 4. Date — smallest, rightmost */
#messagelist td.date,
#messagelist td.date span {
  font-size: 11px !important;
  color: var(--feza-text-muted) !important;
  font-weight: 400 !important;
  text-align: right;
}

/* =============================================
   SAFE COLUMN VISIBILITY — DOM PRESERVED
   ============================================= */

/* Hide 'size' column visually; DOM element stays */
#messagelist td.size,
#messagelist th.size,
#messagelist col.size,
#messagelist colgroup col.size {
  visibility: hidden;
  width: 0 !important;
  max-width: 0 !important;
  min-width: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
  overflow: hidden !important;
  font-size: 0 !important;
  line-height: 0 !important;
}

/* Optionally hide 'threads' count column on small screens */
@media (max-width: 768px) {
  #messagelist td.threads,
  #messagelist th.threads,
  #messagelist col.threads {
    visibility: hidden;
    width: 0 !important;
    padding: 0 !important;
    overflow: hidden;
  }
}

/* =============================================
   MOBILE ENTERPRISE UX — TOUCH OPTIMIZED
   ============================================= */

/* Adaptive row height for touch */
@media (max-width: 768px) {
  #messagelist tbody tr {
    min-height: 56px;
    height: auto;
  }

  #messagelist tbody td {
    padding: 10px 8px !important;
    vertical-align: middle;
  }

  /* Subject is always the headline on mobile */
  #messagelist td.subject {
    font-size: 14px !important;
    font-weight: 600 !important;
    max-width: 100%;
    display: table-cell;
  }

  /* Muted sender below subject (using flex column trick) */
  #messagelist td.from {
    font-size: 11px;
    color: var(--feza-text-muted);
  }

  /* Collapsible sidebar: hides on mobile until toggled */
  #layout-sidebar.feza-collapsed {
    width: 0 !important;
    min-width: 0 !important;
    overflow: hidden !important;
    visibility: hidden;
    transition: width 0.25s ease, visibility 0.25s ease;
  }

  #layout-sidebar:not(.feza-collapsed) {
    width: var(--feza-sidebar-width) !important;
    min-width: var(--feza-sidebar-width) !important;
    visibility: visible;
  }
}

/* Touch-friendly mailbox list items */
@media (hover: none) and (pointer: coarse) {
  #mailboxlist li a,
  #mailboxlist li .mailbox {
    min-height: 48px;
    display: flex;
    align-items: center;
  }

  #messagelist tbody tr {
    min-height: 52px;
  }
}
